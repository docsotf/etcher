resources:
- name: etcher-git-repository
  type: git
  source:
    uri: https://github.com/resin-io/etcher.git
    branch: concourse-test
    disable_ci_skip: true

jobs:
- name: etcher-tests

  # Make the job results accessible to
  # un-authenticated users
  public: true

  plan:
  - get: etcher-git-repository

    # Trigger this job if the resource has a new
    # version. If this is false, the job can only
    # be started from the web UI.
    trigger: true

  - task: dependencies
    config:
      platform: darwin
      inputs:
        - name: etcher-git-repository
      outputs:
        - name: node_modules
      run:
        path: sh
        dir: etcher-git-repository
        args:
          - -exc
          - |
            make electron-develop
            cp -rf node_modules ..

  - task: lint
    config:
      platform: darwin
      inputs:
        - name: etcher-git-repository
        - name: node_modules
          path: etcher-git-repository/node_modules
      run:
        path: make
        dir: etcher-git-repository
        args: [ lint ]

  - task: test
    config:
      platform: darwin
      inputs:
        - name: etcher-git-repository
      run:
        path: make
        dir: etcher-git-repository
        args: [ test ]

  - task: sanity-checks
    config:
      platform: darwin
      inputs:
        - name: etcher-git-repository
      run:
        path: make
        dir: etcher-git-repository
        args: [ sanity-checks ]
